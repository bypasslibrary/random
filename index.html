<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</title>
<style>
*{box-sizing:border-box}
html,body{margin:0;padding:0;min-height:100vh;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;background:radial-gradient(circle at top,#1b1f3b,#05060f);color:#fff}
body{display:flex;justify-content:center;align-items:center}
.container{max-width:480px;width:100%;padding:16px;text-align:center}
h1{margin:8px 0 16px}

.options-wrap{border:1px solid rgba(255,255,255,.35);border-radius:14px;background:rgba(0,0,0,.35);margin-bottom:28px;overflow:hidden}
.options-head{display:flex;justify-content:space-between;padding:10px 14px;cursor:pointer}
.options-body{padding:12px}
.options-wrap.collapsed .options-body{display:none}
textarea{width:100%;min-height:70px;border-radius:10px;border:none;padding:10px;font-size:14px}

.wheel-wrap{position:relative;display:flex;justify-content:center;margin-top:48px}
#wheel{width:340px;height:340px;border-radius:50%;background:#0b0e24;box-shadow:0 0 45px rgba(120,160,255,.35)}
.pointer{position:absolute;top:-18px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-top:22px solid #fff}

.controls{margin-top:18px}
button#spinBtn{padding:18px 46px;font-size:20px;border-radius:40px;border:none;cursor:pointer;background:linear-gradient(135deg,#7f9cff,#4b6bff);color:#fff;box-shadow:0 10px 24px rgba(0,0,0,.45)}
.result{margin-top:14px;min-height:26px}

.settings{position:fixed;top:12px;right:12px;background:rgba(0,0,0,.45);backdrop-filter:blur(6px);border-radius:12px;padding:10px 12px;font-size:12px}
.settings label{display:flex;gap:6px;align-items:center;margin-bottom:6px;cursor:pointer}

canvas.confetti{position:fixed;inset:0;pointer-events:none}
</style>
</head>
<body>

<div class="settings">
  <label><input type="checkbox" id="monoToggle"> –º–æ–Ω–æ—Ö—Ä–æ–º</label>
  <label><input type="checkbox" id="spamToggle"> —Å–ø–∞–º-–∫—Ä—É—Ç–∏—Ç—å</label>
  <label><input type="checkbox" id="hideTextToggle"> —Å–∫—Ä—ã—Ç—å —Ç–µ–∫—Å—Ç</label>
</div>

<div class="container">
<h1>üé° –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</h1>

<div class="options-wrap" id="optWrap">
  <div class="options-head" id="optHead">–í–∞—Ä–∏–∞–Ω—Ç—ã <span id="arrow">‚ñ≤</span></div>
  <div class="options-body">
    <textarea id="options">1
2
3</textarea>
  </div>
</div>

<div class="wheel-wrap">
  <div class="pointer"></div>
  <canvas id="wheel" width="340" height="340"></canvas>
</div>

<div class="controls">
  <button id="spinBtn">–ö—Ä—É—Ç–∏—Ç—å</button>
  <div class="result" id="result"></div>
</div>
</div>

<canvas class="confetti" id="confetti"></canvas>

<script>
const wheel=document.getElementById('wheel');
const ctx=wheel.getContext('2d');
ctx.imageSmoothingEnabled=false;

const optionsInput=document.getElementById('options');
const resultEl=document.getElementById('result');
const monoToggle=document.getElementById('monoToggle');
const spamToggle=document.getElementById('spamToggle');
const hideTextToggle=document.getElementById('hideTextToggle');
const spinBtn=document.getElementById('spinBtn');
const confetti=document.getElementById('confetti');
const cctx=confetti.getContext('2d');

const optWrap=document.getElementById('optWrap');
const optHead=document.getElementById('optHead');
const arrow=document.getElementById('arrow');

let sectors=[],angle=0,velocity=0,spinning=false,holding=false;

optHead.onclick=()=>{optWrap.classList.toggle('collapsed');arrow.textContent=optWrap.classList.contains('collapsed')?'‚ñº':'‚ñ≤'};

function parseSectors(){sectors=optionsInput.value.split('\n').map(v=>v.trim()).filter(Boolean)}

function drawSectorText(text,r,arc){
  const radius=r*0.62;
  const maxWidth=arc*radius*0.9;
  let fontSize=18;
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  while(fontSize>2){
    ctx.font=`${fontSize}px sans-serif`;
    if(ctx.measureText(text).width<=maxWidth) break;
    fontSize--;
  }
  if(fontSize<=2) return;
  ctx.fillText(text,radius,0);
}

function drawWheel(){
  parseSectors();
  const count=Math.max(sectors.length,1);
  const r=wheel.width/2;
  const arc=2*Math.PI/count;

  ctx.clearRect(0,0,wheel.width,wheel.height);
  ctx.save(); ctx.translate(r,r); ctx.rotate(angle);

  for(let i=0;i<count;i++){
    ctx.beginPath(); ctx.moveTo(0,0);
    ctx.arc(0,0,r,i*arc,(i+1)*arc);
    ctx.closePath();
    ctx.fillStyle=monoToggle.checked?'#dfe4ff':`hsl(${i*360/count},85%,60%)`;
    ctx.fill();
    ctx.strokeStyle='rgba(255,255,255,.7)'; ctx.lineWidth=2; ctx.stroke();

    if(sectors[i] && !hideTextToggle.checked){
      ctx.save(); ctx.rotate(i*arc+arc/2);
      ctx.fillStyle='#000'; drawSectorText(sectors[i],r,arc);
      ctx.restore();
    }
  }
  ctx.restore();
}

function finishSpin(){
  if(sectors.length<2) return;
  const arc=2*Math.PI/sectors.length;
  const pointerAngle=-Math.PI/2;
  let a=(pointerAngle-angle)%(2*Math.PI); if(a<0)a+=2*Math.PI;
  const index=Math.floor(a/arc);
  const value=sectors[index]; if(!value) return;
  resultEl.textContent='–†–µ–∑—É–ª—å—Ç–∞—Ç: '+value; launchConfetti();
}

function animate(){
  if(!spinning) return;
  angle+=velocity; velocity*=0.985; drawWheel();
  if(velocity<0.003 && !holding){spinning=false;velocity=0;finishSpin();return}
  requestAnimationFrame(animate);
}

spinBtn.onpointerdown=()=>{
  parseSectors(); if(sectors.length<2){resultEl.textContent='–ú–∏–Ω–∏–º—É–º 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞';return}
  holding=true;
  if(!spinning){spinning=true;velocity=Math.random()*0.45+0.35;resultEl.textContent='';animate()}
  else if(spamToggle.checked){velocity+=0.2}
};
spinBtn.onpointerup=()=>holding=false;
spinBtn.onpointerleave=()=>holding=false;

function resizeConfetti(){confetti.width=innerWidth;confetti.height=innerHeight}
resizeConfetti(); addEventListener('resize',resizeConfetti);

function launchConfetti(){
  const pieces=Array.from({length:200},()=>({x:Math.random()*confetti.width,y:-Math.random()*confetti.height,w:Math.random()*6+4,h:Math.random()*10+6,r:Math.random()*Math.PI,vr:(Math.random()-.5)*0.2,vy:Math.random()*3+2,c:`hsl(${Math.random()*360},90%,60%)`}));
  function fall(){
    cctx.clearRect(0,0,confetti.width,confetti.height); let alive=false;
    for(const p of pieces){p.y+=p.vy;p.r+=p.vr;if(p.y<confetti.height+40)alive=true;cctx.save();cctx.translate(p.x,p.y);cctx.rotate(p.r);cctx.fillStyle=p.c;cctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);cctx.restore()}
    if(alive) requestAnimationFrame(fall);
  }
  fall();
}

optionsInput.oninput=drawWheel;
monoToggle.onchange=drawWheel;
hideTextToggle.onchange=drawWheel;

requestAnimationFrame(drawWheel);
</script>
</body>
</html>
